#!/bin/bash
echo "# Composer #"
composer_link_path="/usr/local/bin/composer"
if [[ ! $(which composer) ]]; then
    echo "Descargando..."
    download -O $temp_path/composer.php https://getcomposer.org/installer
    echo "Instalando..."
    quiet php $temp_path/composer.php --install-dir=$bin_path --filename=composer.phar
    if [[ -f "$bin_path/composer.phar" ]]; then
        delete $composer_link_path
        link "$bin_path/composer.phar" $composer_link_path
        echo "$composer_link_path -> $bin_path/composer"
    else
        echo "Error: No logramos instalar composer"
    fi
fi

if [[ $(which composer) ]]; then
    composer global require laravel/installer
    user=$(whoami)
    home=$(eval echo ~$user)
    if [[ "$EUID" -eq 0 && ! $(confirm "¿continuar como root?") ]]; then
        user=$(prompt "Escribe el nombre de usuario" $user)
        home=$(eval echo ~$user)
    fi
    [[ $home == "~$user" ]] && home=$(prompt "Directorio principal" "/home/$user/")
    [[ $user == "root" ]] && user_composer_config="/root/.composer" || user_composer_config="$home/.config/composer"
    [[ -d $HOME/.composer ]] && default_composer_config=$HOME/.composer
    [[ -d $HOME/.config/composer ]] && default_composer_config=$HOME/.config/composer
    [[ ! -z $composer_config ]] && merge_dir --ignore-existing $default_composer_config $user_composer_config
    echo 'export PATH=$PATH:'"$user_composer_config/vendor/bin" >> "$HOME/.bash_aliases"
fi


    # if [[ ! -z $cf ]]; then
        # composer global require laravel/installer
        # sudo mkdir -p /home/$clientname/.config/
        # echo  >> ~/.bashrc
        # sudo mv /root/.composer /home/$clientname/.config/composer
        # laravel help
    # else
        # echo "Se procede a ignorar la instalación de Laravel"
    # fi
# fi